package com.fdmgroup.controller;

import java.util.Scanner;

import com.fdmgroup.dao.ExamCollectionDao;
import com.fdmgroup.model.Exam;
import com.fdmgroup.model.Question;
import com.fdmgroup.model.Result;
import com.fdmgroup.model.User;

public class ExamController {
	private Exam exam;
	private Result result;
	private User user;
	private ExamCollectionDao examCollectionDao;
	private static ExamController examController;
	private long examTimer;
	Scanner in = new Scanner(System.in);

	private ExamController() {
		super();
		examCollectionDao = ExamCollectionDao.getInstance();
	}

	public static ExamController getInstance() {
		if (examController == null) {
			examController = new ExamController();
		}
		return examController;
	}

	public void startExam(int id) {
			//test//
				Question q1 = new Question("What is red?");
				q1.addPossibleAnswer("a) A shape");
				q1.addPossibleAnswer("b) A color");
				q1.setCorrectAnswer("b");
				Question q2 = new Question("What is 5+2?");
				q2.addPossibleAnswer("a) 7");
				q2.addPossibleAnswer("b) 8");
				q2.setCorrectAnswer("a");
				Exam myExam = new Exam(0, new User(), true, 0);
				myExam.addQuestion(q1);
				myExam.addQuestion(q2);
				examCollectionDao.create(myExam);
			//	
				
		exam = (Exam) examCollectionDao.findById(id);
		if (exam != null) {
			examTimer = exam.getTimer();
			exam.randomize();
			Result r = new Result(0, myExam, new User());
			System.out.println("Starting Exam");
			Question q;
			while (true) {
				q = exam.getNextQuestion();
				if (q == null)
					break;
				else {
					System.out.println(q.getQuestion());
					if (in.next().equalsIgnoreCase(q.getCorrectAnswer())) {
						System.out.println("Correct");
						r.addResultData(true);
					} else {
						System.out.println("Wrong");
						r.addResultData(false);
					}
				}

			}
			System.out.println(r.calculateResult()+"%"); //test
		}
	}
}
